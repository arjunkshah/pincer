(()=>{"use strict";const e={active:!1,profile:"custom",contrast:100,lineSpacing:1.6,colorPreset:"default",fontOverride:!1,fontChoice:"open-dyslexic",dyslexiaFont:!1,reduceMotion:!1,removeClutter:!1,simplifyText:!1,cognitiveMode:"plain",calmMode:!1,highlightActions:!1,enlargeTargets:!1,keyboardMode:!1,openaiApiKey:""},t="pincer-visual-style";function n(e){const n=document.documentElement;let i=document.getElementById(t);i||(i=document.createElement("style"),i.id=t,document.head.appendChild(i));const r=100!==e.contrast?`filter: contrast(${e.contrast}%) !important;`:"",a=1.6!==e.lineSpacing?`line-height: ${e.lineSpacing} !important;`:"";i.textContent=`\n    ${r||a?`html[data-pincer-active] body * { ${r} ${a} }`:""}\n  `.trim(),o(n,"data-pincer-active",e.active),o(n,"data-pincer-dyslexia",e.dyslexiaFont),o(n,"data-pincer-reduce-motion",e.reduceMotion),o(n,"data-pincer-remove-clutter",e.removeClutter),o(n,"data-pincer-enlarge-targets",e.enlargeTargets),o(n,"data-pincer-keyboard",e.keyboardMode),o(n,"data-pincer-highlight-actions",e.highlightActions),Q(n,"data-pincer-color",e.colorPreset&&"default"!==e.colorPreset?e.colorPreset:null),Q(n,"data-pincer-font",(e.fontOverride?e.fontChoice:"open-dyslexic")||"open-dyslexic"),function(){const t=e.fontOverride?e.fontChoice:"open-dyslexic";"open-dyslexic"===t&&function(){if(document.getElementById("pincer-opendyslexic-font"))return;const e=document.createElement("style"),n=chrome.runtime.getURL("opendyslexic-0.92/OpenDyslexic-Regular.otf"),o=chrome.runtime.getURL("opendyslexic-0.92/OpenDyslexic-Italic.otf"),r=chrome.runtime.getURL("opendyslexic-0.92/OpenDyslexic-Bold.otf"),a=chrome.runtime.getURL("opendyslexic-0.92/OpenDyslexic-BoldItalic.otf");e.id="pincer-opendyslexic-font",e.textContent=`@font-face{font-family:'OpenDyslexic';src:url('${n}') format('opentype');font-weight:400;font-style:normal;font-display:swap;}@font-face{font-family:'OpenDyslexic';src:url('${o}') format('opentype');font-weight:400;font-style:italic;font-display:swap;}@font-face{font-family:'OpenDyslexic';src:url('${r}') format('opentype');font-weight:700;font-style:normal;font-display:swap;}@font-face{font-family:'OpenDyslexic';src:url('${a}') format('opentype');font-weight:700;font-style:italic;font-display:swap;}` ,document.head.appendChild(e)}(),"lexend"===t&&function(){if(document.getElementById("pincer-lexend-font"))return;const e=document.createElement("link");e.id="pincer-lexend-font",e.rel="stylesheet",e.href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600&display=swap",document.head.appendChild(e)}()}(),e.dyslexiaFont&&function(){if(document.getElementById("pincer-dyslexic-font"))return;const e=document.createElement("link");e.id="pincer-dyslexic-font",e.rel="stylesheet",e.href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600&display=swap",document.head.appendChild(e);let t=document.getElementById("pincer-dyslexic-font-style");t||(t=document.createElement("style"),t.id="pincer-dyslexic-font-style",document.head.appendChild(t)),t.textContent="\n    html[data-pincer-dyslexia] *:not(code):not(pre):not(.pincer-tooltip) {\n      font-family: 'Lexend', 'Comic Sans MS', Arial, sans-serif !important;\n      word-spacing: 0.2em !important;\n      letter-spacing: 0.04em !important;\n    }\n  "}(),e.reduceMotion&&document.querySelectorAll("video[autoplay]").forEach(e=>{e.pause(),e.removeAttribute("autoplay"),e.dataset.pincerPaused="1"})}function o(e,t,n){n?e.setAttribute(t,""):e.removeAttribute(t)}function Q(e,t,n){n?e.setAttribute(t,n):e.removeAttribute(t)}let i=null,r=!1;const a=["button","a[href]",'input[type="submit"]','input[type="button"]','input[type="reset"]','[role="button"]','[role="link"]',"label[for]"].join(", ");function c(e){e.highlightActions?(l(),r||(r=!0,document.addEventListener("mouseover",h,!0),document.addEventListener("mouseout",E,!0),document.addEventListener("mousemove",g,!1),document.addEventListener("focusin",y,!0),document.addEventListener("focusout",b,!0))):s()}function s(){r&&(r=!1,document.removeEventListener("mouseover",h,!0),document.removeEventListener("mouseout",E,!0),document.removeEventListener("mousemove",g,!1),document.removeEventListener("focusin",y,!0),document.removeEventListener("focusout",b,!0)),u(),i&&(i.remove(),i=null)}function l(){document.getElementById("pincer-action-tooltip")||(i=document.createElement("div"),i.id="pincer-action-tooltip",i.className="pincer-tooltip",i.setAttribute("role","tooltip"),i.setAttribute("aria-live","polite"),document.body.appendChild(i))}function d(e,t,n){i||l(),i.textContent=e,i.classList.add("visible"),m(t,n)}function u(){i&&i.classList.remove("visible")}function m(e,t){if(!i)return;const n=12,o=i.offsetWidth||200,r=i.offsetHeight||40;let a=e+n,c=t+n;a+o>window.innerWidth-n&&(a=e-o-n),c+r>window.innerHeight-n&&(c=t-r-n),i.style.left=`${Math.max(n,a)}px`,i.style.top=`${Math.max(n,c)}px`}let p=0,f=0;function g(e){p=e.clientX,f=e.clientY,i&&i.classList.contains("visible")&&m(p,f)}function h(e){const t=e.target.closest(a);if(!t||t.closest("[data-pincer-ignore]"))return;const n=v(t);n&&d(n,p,f)}function E(e){e.target.closest(a)&&u()}function y(e){const t=e.target.closest(a)||e.target;if(!t.matches(a))return;const n=v(t);if(n){const e=t.getBoundingClientRect();d(n,e.left,e.bottom+4)}}function b(){u()}function v(e){const t=e.tagName.toLowerCase(),n=(e.getAttribute("type")||"").toLowerCase(),o=e.getAttribute("href")||"",i=(e.getAttribute("role")||"").toLowerCase(),r=e.getAttribute("aria-label"),a=e.getAttribute("title"),c=function(e){return(e.innerText||e.textContent||"").replace(/\s+/g," ").trim().slice(0,80)}(e).trim(),s=r||a||c;if("submit"===n||"button"===t&&function(e){const t=(e.getAttribute("type")||"").toLowerCase();return"submit"===t||""===t&&!!e.closest("form")}(e)){const t=function(e){const t=e.closest("form");return t&&(t.getAttribute("aria-label")||t.getAttribute("name")||t.getAttribute("id"))||null}(e);return t?`Submits the "${t}" form. This action may be irreversible.`:"Submits this form. This action may be irreversible."}if("reset"===n)return"Clears all fields in this form and resets to defaults.";if(/delete|remove|cancel|close|dismiss/i.test(s))return`${s} — This may permanently remove or discard something.`;if(e.hasAttribute("download")||/download|export/i.test(s))return`Downloads a file${s?": "+s:""}.`;if("a"===t&&o){if("_blank"===e.target||o.startsWith("http")){const e=function(e){try{return new URL(e,location.href).hostname}catch{return null}}(o);return e?`Opens ${e} in a new tab.`:"Opens a link in a new tab."}return o.startsWith("mailto:")?`Opens your email app to send a message to ${o.replace("mailto:","")}.`:o.startsWith("tel:")?`Calls ${o.replace("tel:","")}.`:o.startsWith("#")?"Jumps to a section on this page.":s?`Goes to: ${s}`:"Navigates to another page."}return"button"===t||"button"===i?s?`Button: ${s}`:"Performs an action.":s?`Action: ${s}`:null}const x=new Map;let C=!1;function T(){if(!C)return;x.forEach((e,t)=>{t instanceof Text&&t.isConnected?t.textContent=e:t instanceof Element&&t.isConnected&&(t.innerHTML=e,t.removeAttribute("data-pincer-rewritten"))}),x.clear(),C=!1;const e=document.getElementById("pincer-info-banner");e&&e.remove()}function A(){return document.querySelector("main")||document.querySelector('[role="main"]')||document.querySelector("article")||document.querySelector("#content")||document.querySelector("#main")||document.body}function L(e){if(!e)return!1;const t=window.getComputedStyle(e);return"none"!==t.display&&"hidden"!==t.visibility&&"0"!==t.opacity&&null!==e.offsetParent}function w(e){if(!e)return!0;const t=e.tagName.toLowerCase();return!!(["script","style","noscript","code","pre","nav","footer","header"].includes(t)||e.closest("[data-pincer-ignore]")||e.closest("#pincer-info-banner")||e.closest(".pincer-tooltip"))}function N(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}const k=new Map,R=[/FINAL\s+NOTICE/i,/IMMEDIATE\s+ACTION/i,/URGENT/i,/WARNING[:\s!]/i,/ALERT[:\s!]/i,/CRITICAL/i,/OVERDUE/i,/PAST\s+DUE/i,/SUSPENDED/i,/TERMINATED/i,/LAST\s+CHANCE/i,/ACT\s+NOW/i,/EXPIRES?\s+SOON/i,/ACCOUNT\s+LOCKED/i,/SECURITY\s+BREACH/i,/YOU\s+MUST/i,/FAILURE\s+TO/i,/PENALTY/i,/CONSEQUENCES/i];function S(){k.forEach((e,t)=>{t instanceof Text&&t.isConnected&&(t.textContent=e,t.parentElement&&t.parentElement.removeAttribute("data-pincer-calmed"))}),k.clear()}function K(e){if(!e||0===e.length)return;const t=new Map;e.forEach(e=>{e.original&&e.calm&&t.set(e.original.trim(),e.calm.trim())});if(0===t.size)return;const n=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,{acceptNode(e){if(!e.parentElement)return NodeFilter.FILTER_REJECT;if(e.closest&&e.closest("[data-pincer-ignore]"))return NodeFilter.FILTER_REJECT;const t=e.parentElement.tagName.toLowerCase();return["script","style","noscript"].includes(t)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}),o=[];let i;for(;i=n.nextNode();)o.push(i);o.forEach(e=>{const n=e.textContent.trim();t.has(n)?(k.set(e,e.textContent),e.textContent=t.get(n),e.parentElement&&e.parentElement.setAttribute("data-pincer-calmed","")):t.forEach((t,n)=>{e.textContent.includes(n)&&(k.has(e)||k.set(e,e.textContent),e.textContent=e.textContent.replace(n,t),e.parentElement&&e.parentElement.setAttribute("data-pincer-calmed",""))})})}function Z(){const e=new Set;return document.querySelectorAll(["[role=\"alert\"]","[role=\"status\"]",".alert",".warning",".error",".notice",".notification",".banner",'[class*=\"alert\"]','[class*=\"warning\"]','[class*=\"error\"]','[class*=\"notice\"]','[class*=\"notification\"]',"h1","h2","h3","p"].join(", ")) .forEach(t=>{if(t.closest("[data-pincer-ignore]"))return;const n=(t.innerText||t.textContent||"").trim();n.length<5||n.length>500||R.some(e=>e.test(n))&&e.add(n)}),Array.from(e).slice(0,20)}function J(e){}let I=!1,F=!1;function M(e){e.keyboardMode?I||(I=!0,document.addEventListener("keydown",P,!0),F||(F=!0,document.addEventListener("keydown",$,!1))):_()}function _(){I&&(I=!1,document.removeEventListener("keydown",P,!0),document.removeEventListener("keydown",$,!1),F=!1)}function P(e){if(("Enter"===e.key||" "===e.key)&&e.target){const t=e.target.tagName.toLowerCase();if("button"!==t&&"a"!==t&&"input"!==t&&"select"!==t&&"textarea"!==t){const t=e.target.getAttribute("role");"button"!==t&&"link"!==t&&"menuitem"!==t||e.target.click()}}"Escape"===e.key&&document.activeElement&&document.activeElement.blur()}function $(e){if("PageDown"===e.key||"PageUp"===e.key){const t="PageDown"===e.key?1:-1,n=.8*window.innerHeight;window.scrollBy({top:t*n,behavior:"smooth"}),e.preventDefault()}}let D=null,O=!1;function W(){var t;O||(O=!0,function(){if(document.querySelector(".pincer-skip-link"))return;const e=document.querySelector('main, [role="main"], #main, #content');if(!e)return;e.id||(e.id="pincer-main");const t=document.createElement("a");t.className="pincer-skip-link",t.href=`#${e.id}`,t.textContent="Skip to main content",document.body.prepend(t)}(),t=e=>{D=e,e.active&&function(e){n(e),c(e),M(e),J(e)}(e)},"undefined"!=typeof chrome&&chrome.storage?chrome.storage.local.get("pincerPrefs",n=>{const o=n.pincerPrefs||{};t({...e,...o})}):t({...e}))}chrome.runtime.onMessage.addListener((e,o,i)=>{switch(e.type){case"PREFS_UPDATED":{const o=D;D=e.prefs,function(e,o){if(!o.active)return function(){const e=document.documentElement;["data-pincer-active","data-pincer-dyslexia","data-pincer-reduce-motion","data-pincer-remove-clutter","data-pincer-enlarge-targets","data-pincer-keyboard","data-pincer-highlight-actions","data-pincer-color","data-pincer-font"].forEach(t=>e.removeAttribute(t));const n=document.getElementById(t);n&&n.remove()}(),s(),_(),T(),void S();n(o),o.highlightActions!==(e&&e.highlightActions)?o.highlightActions?c(o):s():o.highlightActions&&c(o),M(o),o.calmMode&&(!(e&&e.calmMode))&&J(o),e&&e.calmMode&&!o.calmMode&&S(),e&&e.simplifyText&&!o.simplifyText&&T()}(o,e.prefs),i({ok:!0});break}case"EXTRACT_TEXT":i({text:function(){const e=A(),t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:e=>L(e.parentElement)?w(e.parentElement)||e.textContent.trim().length<20?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT});let o,i=0;for(;(o=n.nextNode())&&i<8e3;){const e=o.textContent.trim();t.push(e),i+=e.length}return t.join("\n")}()});break;case"EXTRACT_ALERTS":i({texts:function(){const e=new Set;return document.querySelectorAll(['[role="alert"]','[role="status"]',".alert",".warning",".error",".notice",".notification",".banner",'[class*="alert"]','[class*="warning"]','[class*="error"]','[class*="notice"]','[class*="notification"]',"h1","h2","h3","p"].join(", ")).forEach(t=>{if(t.closest("[data-pincer-ignore]"))return;const n=(t.innerText||t.textContent||"").trim();n.length<5||n.length>500||R.some(e=>e.test(n))&&e.add(n)}),Array.from(e).slice(0,20)}()});break;case"APPLY_REWRITE":(function(e,t){if(!e)return;T();const n=function(e,t){switch(t){case"bullets":return e.bullet_version;case"steps":return e.step_version;case"literal":return e.literal_version;case"actions":return e.actions_detected;default:return e.simplified_text}}(e,t);if(!n)return;const o=A(),i=document.createTreeWalker(o,NodeFilter.SHOW_TEXT,{acceptNode:e=>L(e.parentElement)?w(e.parentElement)||e.textContent.trim().length<20?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}),r=[];let a;for(;a=i.nextNode();)r.push(a);if(0!==r.length){if("string"==typeof n){const e=r[0];x.set(e,e.textContent),e.textContent=n,(c=e.parentElement)&&c.setAttribute("data-pincer-rewritten","")}else if(Array.isArray(n)){const e=r[0];x.set(e,e.textContent);const t=document.createElement("div");t.setAttribute("data-pincer-rewritten",""),t.setAttribute("data-pincer-ignore",""),t.style.cssText="\n      font-family: inherit;\n      line-height: 1.8;\n      margin: 0;\n      padding: 0;\n    ",n.forEach(e=>{const n=document.createElement("p");n.style.cssText="margin: 0 0 0.5em; padding: 0;",n.textContent=e,t.appendChild(n)});const o=e.parentElement;o&&o!==document.body&&(x.set(o,o.innerHTML),o.innerHTML="",o.appendChild(t),o.setAttribute("data-pincer-rewritten",""))}var c;C=!0,function(e){const t=document.getElementById("pincer-info-banner");t&&t.remove();const n=e.actions_detected||[],o=e.deadlines_detected||[];if(0===n.length&&0===o.length)return;const i=document.createElement("div");i.id="pincer-info-banner",i.setAttribute("data-pincer-ignore",""),i.style.cssText="\n    position: fixed;\n    bottom: 16px;\n    right: 16px;\n    z-index: 2147483646;\n    background: #111111;\n    color: #ffffff;\n    font-family: 'JetBrains Mono', monospace;\n    font-size: 11px;\n    line-height: 1.6;\n    padding: 12px 16px;\n    border-radius: 2px;\n    border-left: 3px solid #D72638;\n    max-width: 300px;\n    box-shadow: 0 2px 12px rgba(0,0,0,0.3);\n  ";let r="";n.length>0&&(r+='<div style="font-weight:700;color:#D72638;margin-bottom:6px;letter-spacing:0.08em;text-transform:uppercase;font-size:9px;">Actions Required</div>',n.forEach(e=>{r+=`<div style="margin-bottom:3px;">→ ${N(e)}</div>`})),o.length>0&&(r+=`<div style="font-weight:700;color:#D72638;margin:${n.length>0?"8px":"0"} 0 6px;letter-spacing:0.08em;text-transform:uppercase;font-size:9px;">Deadlines</div>`,o.forEach(e=>{r+=`<div style="margin-bottom:3px;">⏰ ${N(e)}</div>`})),i.innerHTML='<button onclick="this.parentElement.remove()" style="position:absolute;top:6px;right:8px;background:none;border:none;color:#888;cursor:pointer;font-size:14px;font-family:monospace;padding:0;line-height:1;">×</button>'+r,document.body.appendChild(i)}(e)}})(e.data,e.mode),i({ok:!0});break;case"APPLY_CALM":K(e.replacements),i({ok:!0})}return!0}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",W):W()})();